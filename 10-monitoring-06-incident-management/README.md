# Домашнее задание к занятию "10.06. Инцидент-менеджмент"

## Задание 1

Составьте постмортем, на основе реального сбоя системы Github в 2018 году.

Информация о сбое доступна [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/) , а
также [развёрнуто на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

## Ответ:

Прежде всего, выражаю благодарность Сергею Андрюнину, за чёткую подачу материала, интересные истории из офтопа и советы.
На протяжении всех лекций чувствовался уровень компетенций, чёткий ход мыслей, а также своего рода наставничество. Было очень интересно и круто. Спасибо!

**Постмортем:**

| Раздел | Описание |
|----------:|:----------|
| Краткое описание инцидента | 21 октября в 22:52 UTC Произошла потеря связи между сетевым центром на восточном побережье США и основным ЦОД на восточном побережье США. Связь между этими точками была восстановлена за 43 секунды, но этот кратковременный сбой вызвал цепочку событий, которые привели к ухудшению качества обслуживания на 24 часа 11 минут. |
| Предшествующие события | Плановые работы по техническому обслуживанию и замене вышедшего из строя оптического оборудования 100G |
| Причина инцидента | Потеря согласованности между БД в двух ЦОДах |
| Воздействие | Пользователи не могли оставлять PR и issues, управлять аутентификацией, координировать фоновые процессы, кроме того, не работали web-хуки, а также сайты на GitHub Pages течение 24 часов 11 минут |
| Обнаружение | 21 октября 2018 22:54 UTC инженеры быстрого реогирования обнаружили предупреждения от системы мониторинга и через API Orchestrator определили, что топология репликации базы данных включает сервера только одного ЦОД. Все данные переданы разработчикам. |
| Реакция | Команда разработчиков приняла решение вручную заблокировать внутренние инструменты развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений. Команда перевела сайт в желтый статус. Это действие автоматически перевело ситуацию в активный инцидент и отправило предупреждение координатору инцидента. Координатор инцидента через две минуты принял решение изменить статус на красный. Защита конфиденциальности и целостности пользовательских данных поставлена выше, чем продолжительная деградация сервиса. |
| Восстановление| План состоял в том, чтобы восстановиться из резервных копий, синхронизировать реплики, вернуться к стабильной топологии обслуживания и затем возобновить обработку заданий в очереди. |
| Таймлайн | <ul><li> 21 октября 2018, 22:52 UTC - Разрыв связи между двумя ЦОДами</li><li> 21 октября 2018 22:54 UTC - Инженеры быстрого реагирования получают предупреждения от системы мониторинга.</li><li> 21 октября 2018 23:02 UTC - Запросы к API Orchestrator показали, что топология репликации базы данных включает сервера только одного ЦОД. Все данные переданы разработчикам.</li><li> 21 октября 2018 23:07 UTC - Команда разработчиков решила вручную заблокировать внутренние инструменты развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений.</li><li> 21 октября 2018 23:09 UTC - Команда переводит статус в жёлтый. Это действие автоматически перевело ситуацию в активный инцидент и отправило предупреждение координатору инцидента.</li><li> 21 октября 2018 23:11 UTC - Подключился координатор инцидента и принял решение изменить статус на красный</li><li> 21 октября 2018 23:13 UTC - Были вызваны дополнительные инженеры из группы разработки баз данных. Они начали исследовать текущее состояние, чтобы определить, какие действия необходимо предпринять, чтобы вручную настроить базу данных Восточного ЦОД в качестве основной для каждого кластера и перестроить топологию репликации. Выставлен приоритет на защиту конфиденциальности и целостности пользовательских данных.</li><li> 21 октября 2018 23:19 UTC - Стало ясно, что нужно остановить выполнение заданий, которые записывают метаданные, а также приостановить доставку web-хуков и сборки GitHub Pages</li><li> 22 октября 2018 00:05 UTC - Начали разработку плана по восстановлению из резервных копий, синхронизации реплик на обоих ЦОД, вернуться к стабильной топологии обслуживания и затем возобновить обработку заданий в очереди. Обновлён статус для информирования пользователей.</li><li> 22 октября 2018 00:41 UTC - Запущен процесс резервного копирования всех затронутых кластеров MySQL</li><li> 22 октября 2018 06:51 UTC - Несколько кластеров завершили восстановление из резервных копий в центре обработки данных на восточном ЦОД и начали репликацию новых данных с западного побережья. Более крупные кластеры баз данных все еще восстанавливались.</li><li> 22 октября 2018 07:46 UTC - GitHub опубликовал сообщение в блоге с извинениями</li><li> 22 октября 2018 11:12 UTC - Все первичные базы данных снова установлены на Восточном ЦОД. Часть реплик всё ещё отставала от основной БД.</li><li> 22 октября 2018 13:15 UTC - Группа реагирования на инциденты провела обсуждение дальнейших действий. Задержки репликации увеличились из-за пиковой нагрузки.</li><li> 22 октября 2018 16:24 UTC - Реплики были синхронизированы, выполнили аварийное переключение на исходную топологию. Статус службы всё ещё красный, начали обрабатывать накопленные данные.</li><li> 22 октября 2018 16:45 UTC - Произвели балансировку увеличившейся нагрузки и начали обработки очереди web-хуков и сборок страниц.</li><li> 22 октября 2018 23:03 UTC - Все незавершенные веб-перехватчики и сборки страниц были обработаны, и целостность и правильность работы всех систем были подтверждены. Статус сайта был обновлен до зеленого.</li></ul> |
| Последующие действия | По результатам анализа данного инцидента сделаны выводы и технические доработки. Необходимо перенастроить конфигурацию Orchestrator для предотвращения перехода primory БД в другой регион. Ускорить переход на новый механизм отчётности о статусе инцидента и отображении статуса различных компанентов платформы. Сделать избыточное резервирование данных ЦОД для увеличения надёжности системы. Начать систематические проверки сценариев сбоя и возможных путей их решения до того, как они смогут повлиять на пользователей. |

## Задача повышенной сложности

Прослушайте [симуляцию аудиозаписи о инциденте](https://youtu.be/vw6I5DYWkNA?t=1), предоставленную 
разработчиками инструмента для автоматизации инцидент-менеджмента PagerDuty.

На основании этой аудиозаписи попробуйте составить сообщения для пользователей о данном инциденте.

Должно быть 3 сообщения о:
- начале инцидента
- продолжающихся работах
- окончании инцидента и возвращении к штатной работе
